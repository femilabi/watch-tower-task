import"../root.js";import{A,D as O,b as L,d as f,g as P,c as e,m as $,M as T,S as v}from"../index2.js";import"../common4.js";/* empty css              *//* empty css                     *//* empty css      *//* empty css               */const{error:U}=A();new O({itemRenderer(l){const t=new N({postBackLinksCount:l.post_back_links_count,postCreatedOn:l.post_created_on,postReference:l.post_id,postStatus:l.post_status,postTitle:l.post_title,postTotal:l.post_total,postType:l.post_type,postDomain:l.post_domain});return console.log(t.element),t.element},keyExtractor:"payment_id",listContentContainer:".list-content-container .list",pagination:{key:"history",containerClassName:".page-content",fetchUrl:f.postsFetchUrl,filters:[...Array.from(P(".payment-filter input[type='radio']")).map(l=>({key:l.getAttribute("name"),element:l})),{key:"search",element:L(".search-filter")},{key:"category",element:L(".category-filter")}]}});const b=Intl.NumberFormat("en-us",{style:"currency",currency:"USD"});class N{constructor({element:t,postTitle:o,postBackLinksCount:a,postType:s,postCreatedOn:n,postTotal:i,postStatus:r,postReference:c,postDomain:p}){this.postId=c,this.postTitle=o,this.postDomain=p,this.postBackLinksCount=a,this.postType=s,this.postCreatedOn=n,this.postTotal=i,this.postStatus=r,this.element=t,this.postBackLinksCountElement=null,this.postDueInElement=null,this.postStatusElement=null,this.postActionElement=null,this.payNowButton=null,this.cancelButton=null,this.viewButton=null,this.countDownTimer=null,this.init()}init(){this.element?this.initExistingElement():this.createElement(),this.postStatus==="paid"||(this.countDownTimer=setInterval(()=>{this.updateCountDown()},1e3)),this.updateUI()}initExistingElement(){var t,o,a;this.postId=this.element.dataset.post_id,this.postStatus=this.element.dataset.post_status,this.postBackLinksCount=this.element.dataset.post_back_links_count,this.postTitle=this.element.dataset.post_title,this.postDomain=this.element.dataset.post_domain,this.postBackLinksCountElement=this.element.querySelector(".post-back-links-count p"),this.postType=this.element.dataset.post_type,this.postCreatedOn=this.element.dataset.post_created_on,this.postTotal=this.element.dataset.post_total,this.postDueInElement=this.element.querySelector(".post-due-in p"),this.postStatusElement=this.element.querySelector(".post-status p"),this.postActionElement=this.element.querySelector(".post-action"),(t=this.postActionElement.querySelector(".pay"))==null||t.replaceWith(this.createPayNowButton()),(o=this.postActionElement.querySelector(".cancel"))==null||o.replaceWith(this.createCancelButton()),(a=this.postActionElement.querySelector(".view"))==null||a.replaceWith(this.createViewButton())}createElement(){const t=e("li","item row"),o=e("div","post-title",`<p>${this.postTitle}</p>`),a=e("div","post-back-links-count");this.postBackLinksCountElement=e("p","",`
      <svg width="12" height="12" viewbox="0 0 16 16">
        <use href="/assets/icons.svg#link" />
      </svg>
      `,{"data-active":this.postBackLinksCount}),a.appendChild(this.postBackLinksCountElement);const s=e("div","post-domain",`<p>${this.postDomain}</p>`),n=e("div","post-type",`<p>${this.postType}</p>`),i=e("div","post-created-on",`<p>${this.postCreatedOn}</p>`),r=e("div","post-total",`<p>${this.postTotal}</p>`),c=e("div","post-due-in");this.postDueInElement=e("p"),c.appendChild(this.postDueInElement);const p=e("div","post-status");this.postStatusElement=e("p","","",{"data-status":this.postStatus}),p.appendChild(this.postStatusElement);const u=e("div","post-action");if(this.postStatus==="paid"){const d=this.createViewButton();u.appendChild(d)}else{const d=this.createPayNowButton(),y=this.createCancelButton();u.append(d,y)}this.postActionElement=u;const m=e("div","divider");t.append(o,s,a,n,i,r,c,p,u,m),this.element=t}calculatePostStatus(){const t=this.postStatus==="paid",o=new Date(this.postCreatedOn),a=parseInt(f.postGracePeriod),s=new Date(o);s.setHours(s.getHours()+a);const n=s-new Date,i=n<=0,r=Math.max(n,0),c=Math.floor(r/(1e3*60*60)),p=Math.floor(r%(1e3*60*60)/(1e3*60)),u=Math.floor(r%(1e3*60)/1e3),m=`${c.toString().padStart(2,"0")}
      :${p.toString().padStart(2,"0")}
      :${u.toString().padStart(2,"0")}`,d=this.postStatus==="cancelled",y=!d&&!t&&!i&&c<=a;return{isClear:t,isDue:y,dueInTime:m,isOverDue:i,isCancelled:d}}updateCountDown(){var i;const{dueInTime:t,isDue:o,isClear:a,isOverDue:s,isCancelled:n}=this.calculatePostStatus();if(this.stripDataAttributes(this.postBackLinksCountElement),this.stripDataAttributes(this.postDueInElement),a){this.postStatus="paid",clearInterval(this.countDownTimer),this.updateUI(),this.countDownTimer=null,this.postBackLinksCountElement.setAttribute("data-active",this.postBackLinksCount);return}if(o){this.postStatus="unpaid",this.postBackLinksCountElement.setAttribute("data-pending",this.postBackLinksCount),(i=this.postDueInElement)==null||i.setAttribute("data-due-in",t);return}if(s||n){clearInterval(this.countDownTimer),this.countDownTimer=null,this.postStatus="cancelled",this.updateUI(),this.postBackLinksCountElement.setAttribute("data-inactive",this.postBackLinksCount),this.postDueInElement.setAttribute("data-inactive","");return}}createPaymentSummaryDialogue({author_name:t,post_title:o,post_category_cost:a,post_amount:s,post_links:n}){let i=e("div","overflow",void 0,{role:"dialogue","data-modal-element":"",id:"payment-modal","data-modal-title":"Checkout","aria-label":"Payment Dialogue"});const r=e("div","content-wrapper"),c=e("div","content"),p=e("header"),u=$("thumbs-up",117),m=e("h2",void 0,"Pay & Publish Now");p.append(u,m);const d=e("div","summary"),y=this.createSummaryGroup(),C=this.createSummaryItem("customer-name","Customer Name",t);y.append(C);const k=this.createSummaryGroup(),B=this.createSummaryItem("blog-title","Blog Title",o);k.append(B);const h=this.createSummaryGroup("total-links"),E=this.createSummaryItem("","Total Links",parseInt(n)),g=this.createSummaryItem("cost-per-link","Cost per Link",b.format(parseFloat(a)));h.append(E,g);const w=this.createSummaryGroup("total"),S=this.createSummaryItem("total","Total",b.format(parseFloat(s)));w.append(S),d.append(y,k,h,w);const D=e("div",void 0,void 0,{id:"paypal-pay-button-wrapper"});c.append(p,d,D),r.append(c),i.append(r),T(i),document.body.append(i);function I(_){_.detail===i&&(this.payNowButton.idle(),setTimeout(()=>{i.remove(),i=null},1e3),window.removeEventListener("modal-close",I))}return window.addEventListener("modal-close",I),{modal:i,paypalButtonWrapper:D}}createSummaryGroup(t){return e("div",`summary-group ${t||""}`)}createSummaryItem(t,o,a){const s=e("div",`summary-item ${t||""}`),n=e("div","title",o),i=e("div","value",a);return s.append(n,i),s}createCancelPaymentModal(){let t=e("div","overflow",void 0,{role:"dialogue","data-modal-element":"",id:"cancel-payment","data-modal-title":"Cancel Payment","aria-label":"Cancel Payment Modal"});const o=e("div","content-wrapper"),a=e("div","content"),s=e("h3","title","Are you sure, you want to cancel this order?"),n=e("p","desctiption","Your post will remain active but all backlinks will be removed. Contact The Webmaster for post removal."),i=e("div","actions-wrapper"),r=e("button","reject clickable","No"),c=e("button","proceed dynamic-button clickable","<span class='idle'>Yes, Cancel</span>");v(c),i.append(r,c),a.append(s,n,i),o.append(a),t.append(o),T(t),document.body.append(t);function p(u){var m;u.detail===t&&((m=this.cancelButton)==null||m.idle(),setTimeout(()=>{t.remove(),t=null},1e3),window.removeEventListener("modal-close",p))}return r.onclick=()=>{t.close()},window.addEventListener("modal-close",p),{modal:t,proceed:c,cancel:r}}createViewOrderModal({author:t,post_title:o,post_links:a,post_cost_per_link:s,post_total:n,post_url:i}){let r=e("div","overflow",void 0,{role:"dialogue","data-modal-element":"",id:"view-order","data-modal-title":"Order Details","aria-label":"View Order Details"});const c=e("div","content-wrapper"),p=e("div","content"),u=e("div","detail",`<p>Name</p><p>${t}</p>`),m=e("div","detail",`<p>Blog Title</p><p>${o}</p>`),d=e("div"),y=e("div","detail",`<p>Total Links</p><p>${a}</p>`),C=e("div","detail",`<p>Cost per Link</p><p>${b.format(parseFloat(s))}</p>`),k=e("div","detail",`<p>Total Paid</p><p>${b.format(parseFloat(n))}</p>`),B=e("footer"),h=e("button","copy clickable dynamic-button","<span>Copy Live Link</span>"),E=e("a","view clickable","View Live Link",{href:i,target:"_blank"});v(h),h.onclick=()=>{h.loading();try{window.navigator.clipboard.writeText(i),h.success()}catch{h.error()}},B.append(h,E),d.append(y,C),p.append(u,m,d,k,B),c.append(p),r.append(c),T(r),document.body.append(r);const g=this;function w(S){S.detail===r&&(setTimeout(()=>{g.viewButton.idle(),r.remove(),r=null},1e3),window.removeEventListener("modal-close",w))}return window.addEventListener("modal-close",w),{modal:r}}async cancelOrder(){try{const t=await fetch(f.postCancelApiUrl+"/"+this.postId,{method:"POST",headers:{"Content-Type":"application/json"}}),o=await t.json();if(!t.ok)throw new Error(o.message);return o.data}catch(t){throw t}}initPaypalButton(t,o,a){this.payNowButton.loading();const s=this;try{window.paypal.Buttons({style:{color:"silver",shape:"rect",borderRadius:10,layout:"vertical"},onInit(){},onError(n){console.log("PayPal Error:"+n),this.payNowButton.error()},async createOrder(){const n=new FormData;return n.append("amount",a),n.append("currency","USD"),(await(await fetch("/api/v1/payment/guestblog/paypal-order",{method:"POST",body:n})).json()).data},async onApprove(n,i){try{this.payNowButton.success(),this.postStatus="paid",setTimeout(()=>{s.payNowButton.success(),s.postStatus="paid",clearInterval(s.countDownTimer),setTimeout(()=>{s.updateCountDown()},1e3)},1e3)}catch{this.payNowButton.error()}finally{o.close()}}}).render(t)}catch(n){throw U(n.message,5e3),o.open(),s.submitter.error(),n}}async payNow(){var t,o;try{(t=this.payNowButton)==null||t.loading();const a=await this.getPostData(),{modal:s,paypalButtonWrapper:n}=this.createPaymentSummaryDialogue(a);this.initPaypalButton(n,s,postDetails.post_amount),setTimeout(()=>{s.open()},100)}catch{(o=this.payNowButton)==null||o.error()}}async cancel(){var s;(s=this.cancelButton)==null||s.loading();const{modal:t,proceed:o,cancel:a}=this.createCancelPaymentModal();o.onclick=async()=>{var n,i;try{(n=this.cancelButton)==null||n.loading(),o.loading(),o.success(),clearInterval(this.countDownTimer),this.postStatus="cancelled",setTimeout(()=>{var r;t.close(),(r=this.cancelButton)==null||r.success(),setTimeout(()=>{this.updateCountDown(),this.updateUI()},1500)},1e3)}catch{o.error(),(i=this.cancelButton)==null||i.error()}},a.onclick=()=>{t.close(),setTimeout(()=>{var n;(n=this.cancelButton)==null||n.idle(),t.remove()},500)},setTimeout(()=>{t.open()},200)}async viewOrder(){const t=await this.getPostData(),{modal:o}=this.createViewOrderModal({author:t.authorName,post_title:t.postTitle,post_links:t.linkCount,post_cost_per_link:t.linkCost,post_total:t.linkTotal,post_url:t.postUrl});setTimeout(()=>{o.open()},200)}async getPostData(){try{const t=await fetch(f.postGetBlogUrl+"/"+this.postId,{method:"GET",headers:{"Content-Type":"application/json"}}),o=await t.json();if(!t.ok)throw new Error(o.message);return o.data}catch(t){throw t}}async sendData(t,o){return new Promise((a,s)=>{const n=new XMLHttpRequest;n.addEventListener("load",function(){try{const c=JSON.parse(n.response);n.status>=200&&n.status<300?a(c):s(new Error(c.message||"Request failed"))}catch{s(new Error("Invalid JSON response"))}}),n.addEventListener("error",()=>{s(new Error("Network error occurred"))}),n.addEventListener("timeout",()=>{s(new Error("Request timed out"))});const i=o instanceof FormData,r=!i&&typeof o=="object";try{n.open("POST",t,!0),n.timeout=3e4,r&&n.setRequestHeader("Content-Type","application/json"),n.send(i?o:JSON.stringify(o))}catch{s(new Error("Failed to send request"))}})}createViewButton(){const t=e("button","view dynamic-button clickable","<span class='idle'>View</span>");return v(t),this.viewButton=t,this.viewButton.onclick=async()=>{try{t.loading(),await this.viewOrder(),t.success()}catch{t.error()}},t}createPayNowButton(){const t=e("button","pay clickable dynamic-button","<span>Pay Now</span>");return v(t),this.payNowButton=t,this.payNowButton.onclick=()=>{this.payNow()},t}createCancelButton(){const t=e("button","cancel clickable dynamic-button","<span>Cancel</span>");return v(t),this.cancelButton=t,this.cancelButton.onclick=()=>{this.cancel()},t}createReorderButton(){const t=e("a","reorder view clickable","<span>Reorder</span>",{href:`/writeforus/app/link-insertion/${this.postId}`});return this.reorderButton=t,t}updateUI(){this.postStatusElement.setAttribute("data-status",this.postStatus),this.postStatus==="paid"?this.postActionElement.replaceChildren(this.createViewButton()):this.postStatus==="unpaid"?this.postActionElement.replaceChildren(this.createPayNowButton(),this.createCancelButton()):this.postActionElement.replaceChildren(this.createReorderButton())}stripDataAttributes(t){for(let o=0;o<t.attributes.length;o++){const a=t.attributes[o];a.name.startsWith("data-")&&t.removeAttribute(a.name)}}}P(".content .item").forEach(l=>new N({element:l}));
